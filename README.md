# 旅游日记后台文档

## 0. 地址

- 旅游日记PC管理端地址:

https://github.com/gnb-666/pgy-travel-pc.git

- 旅游日记小程序地址:

https://github.com/gnb-666/pgy-xcx.git

## 1. 介绍
旅游日记平台后端开发

## 2. 软件架构
nodejs、MongoDB数据库


## 3. 安装说明

- npm install
- 运行：node index.js

文件说明：

- file 文件夹用于放压缩前图片
- optimized 放的是压缩后的照片
- videos 放视频

## 4. 接口文档

### 4.1 接口说明

- 接口基准地址：`http://localhost:3001/`

#### 4.1.1 支持的请求方法

- GET：从服务器取出资源（一项或多项）。
- POST：在服务器新建一个资源。

#### 4.1.2 通用返回状态说明

| 状态码 | 含义      | 说明             |
| ------ | --------- | ---------------- |
| 200    | Success   | 请求成功         |
| 404    | Not found | 请求的资源不存在 |
| 500    | Error     | 内部错误         |

#### 4.1.3 通用参数说明

| _id  | 是一个MongoDB文档的唯一标识符，用于在集合中标识和查找文档 |
| ---- | --------------------------------------------------------- |

### 4.2 PC管理端接口

#### 4.2.1 管理员登录

- 请求路径：admin/login
- 请求方法：post
- 请求参数：

| 参数名   | 参数说明 | 备注     |
| -------- | -------- | -------- |
| username | 用户名   | 不能为空 |
| password | 密码     | 不能为空 |

#### 4.2.2 审核

- 请求路径：reviewTravelNote
- 请求方法：post
- 请求参数：

| 参数名       | 参数说明                                      | 备注     |
| ------------ | --------------------------------------------- | -------- |
| _id          | 唯一ID                                        | 不能为空 |
| state        | 审核状态（0表示待审核，1表示通过，2表示驳回） | 不能为空 |
| rejectReason | 驳回原因（如果状态为2则必填）                 | 可以为空 |

#### 4.2.3 获取后台游记列表

- 请求路径：admin/getTravelNotes
- 请求方法：post
- 请求参数：

| 参数名 | 参数说明                                               | 备注     |
| ------ | ------------------------------------------------------ | -------- |
| page   | 页数                                                   | 不能为空 |
| size   | 每页记录数                                             | 不能为空 |
| search | 搜索关键词或状态（例如，“待审核”，“已通过”，“已驳回”） | 不能为空 |

#### 4.2.4 删除

- 请求路径：deleteTravelNote
- 请求方法：post
- 请求参数：

| 参数名 | 参数说明 | 备注     |
| ------ | -------- | -------- |
| _id    | 唯一ID   | 不能为空 |

#### 4.2.5 恢复

- 请求路径：reviewTravelNote
- 请求方法：post
- 请求参数：

| 参数名 | 参数说明 | 备注     |
| ------ | -------- | -------- |
| _id    | 唯一ID   | 不能为空 |

### 4.3 小程序端接口

#### 4.3.1 获取首页的游记数据

- 请求路径：getTravelNotes
- 请求方法：get
- 请求参数：无

#### 4.3.2 获取游记详情

- 请求路径：getTravelNoteDetail
- 请求方法：get
- 请求参数：

| 参数名 | 参数说明 | 备注     |
| ------ | -------- | -------- |
| _id    | 唯一ID   | 不能为空 |

#### 4.3.3 发布游记

- 请求路径：publishTravelNote
- 请求方法：post
- 请求参数：

| 参数名   | 参数说明       | 备注     |
| -------- | -------------- | -------- |
| _id      | 唯一ID         | 不能为空 |
| title    | 游记标题       | 不能为空 |
| content  | 游记内容       | 不能为空 |
| imgList  | 游记照片数组   | 不能为空 |
| openid   | 用户唯一标识符 | 不能为空 |
| videoUrl | 视频地址       | 可以为空 |

#### 4.3.4 上传图片

- 请求路径：uploadImg
- 请求方法：post
- 请求参数：

| 参数名 | 参数说明 | 备注     |
| ------ | -------- | -------- |
| file   | 图片文件 | 不能为空 |

#### 4.3.5 上传视频

- 请求路径：uploadVideo
- 请求方法：post
- 请求参数：

| 参数名 | 参数说明 | 备注     |
| ------ | -------- | -------- |
| video  | 视频文件 | 不能为空 |

#### 4.3.6 获取我的发布数据

- 请求路径：getMyPublish
- 请求方法：get
- 请求参数：

| 参数名 | 参数说明   | 备注     |
| ------ | ---------- | -------- |
| openid | 用户openid | 不能为空 |

#### 4.3.7 删除

- 请求路径：deleteTravelNote
- 请求方法：post
- 请求参数：

| 参数名 | 参数说明 | 备注     |
| ------ | -------- | -------- |
| _id    | 游记ID   | 不能为空 |

#### 4.3.8 登录

- 请求路径：toLogin
- 请求方法：post
- 请求参数：

| 参数名   | 参数说明 | 备注     |
| -------- | -------- | -------- |
| username | 用户名   | 不能为空 |
| password | 密码     | 不能为空 |

#### 4.3.9 注册

- 请求路径：register
- 请求方法：post
- 请求参数：

| 参数名    | 参数说明 | 备注     |
| --------- | -------- | -------- |
| username  | 用户名   | 不能为空 |
| password  | 密码     | 不能为空 |
| date      | 注册日期 | 不能为空 |
| avatarUrl | 头像URL  | 不能为空 |

#### 4.3.10 更换头像

- 请求路径：updateAvatar
- 请求方法：post
- 请求参数：

| 参数名 | 参数说明   | 备注     |
| ------ | ---------- | -------- |
| openid | 用户openid | 不能为空 |

#### 4.3.11 搜索

- 请求路径：searchTravelNotes
- 请求方法：get
- 请求参数：

| 参数名 | 参数说明   | 备注     |
| ------ | ---------- | -------- |
| title  | 搜索关键词 | 不能为空 |
